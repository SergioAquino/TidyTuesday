---
title: "2021_10_05_Registered_Nurses"
author: "Sergio Aquino"
date: "05/10/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```


## Import libraries
```{r}
library(tidyverse)
library(sysfonts)
library(usmap)
```


## Import data
```{r }
tuesdata <- tidytuesdayR::tt_load(2021, week = 41)
nurses <- tuesdata$nurses
```

## Create table to plot
```{r }
nurses <- rename(nurses, name = State) %>%
  filter(Year == 2019) %>%
  select(c(1:3))

pop_state <- read_csv("nst-est2019-alldata.csv")
pop_state <- rename(pop_state, name = NAME) %>%
  select(name, POPESTIMATE2019)

nurses.pop <- inner_join(nurses, pop_state,by= "name")

coord <- read_csv("us_states_coordinates.csv")
nurses.pop.coord <- inner_join(nurses.pop, coord, by="name")

rn.nurses.per.pop <- nurses.pop.coord %>% 
  mutate(rn.per.state = `Total Employed RN`/POPESTIMATE2019 * 1000) %>%
  select(2,1,5,3,4,8,6,7)
```

## Import fonts

```{r}
background <- "#ffffff"
titlefont = "Montserrat"
textfont = "Montserrat"
font_add_google("Crete Round")
```

## Create plot
```{r}
p <- plot_usmap(data = rn.nurses.per.pop , values = "rn.per.state") +
  labs(size = "total employed nurses",
       x = "annual salary",
       y = NULL,
       title = "Annual Salary Per State in 2000 & 2020",
       subtitle = "Dots refer to annual median salary, and the left end 25% percentile and the right 75% percentile.\nThe size of dots refers to total employed registered nurses") +
   theme_void() +
  #transition_states(Year,  transition_length = 2, state_length = 1) +
  theme(legend.position = "right") +  
  #coord_fixed(1.3) +
  ggtitle("Employed Registered Nurses Per State Population", subtitle = 'RN per 1,000 population - 2019') + 
  labs(caption="Sergio Aquino | Data: Data.World, US Cansus | TidyTuesday") +
  theme(plot.title = element_text(family= titlefont, face="bold", hjust=0.5, size=18, color="#000099"),
        plot.subtitle = element_text(family= titlefont, hjust=0.5, size=14, color="#000099"),
        plot.background = element_rect(fill=background, color=background),
        plot.caption = element_text(hjust = 0.5, size=11, family=textfont, color="#000099"),
        legend.position = c(1.0, 0.3125),
        legend.key.size = unit(1, 'cm'),
        legend.text = element_text(size = 8, color="grey35"),
        legend.direction = "vertical",
        legend.title = element_blank(),
        plot.margin = margin(0.5, 0.5, 0.25, 0.5, "cm"))
```


## Save plot
```{r}
ggsave('RegisteredNurses.png', p, scale=1, width=12, height=8,dpi=300)
```

